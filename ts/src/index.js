"use strict";(()=>{var Le=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var s={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};s.cipher.aes=function(e){this._tables[0][0][0]||this._precompute();var t,n,r,i,o,a=this._tables[0][4],c=this._tables[1],l=e.length,h=1;if(l!==4&&l!==6&&l!==8)throw new s.exception.invalid("invalid aes key size");for(this._key=[i=e.slice(0),o=[]],t=l;t<4*l+28;t++)r=i[t-1],(t%l===0||l===8&&t%l===4)&&(r=a[r>>>24]<<24^a[r>>16&255]<<16^a[r>>8&255]<<8^a[r&255],t%l===0&&(r=r<<8^r>>>24^h<<24,h=h<<1^(h>>7)*283)),i[t]=i[t-l]^r;for(n=0;t;n++,t--)r=i[n&3?t:t-4],t<=4||n<4?o[n]=r:o[n]=c[0][a[r>>>24]]^c[1][a[r>>16&255]]^c[2][a[r>>8&255]]^c[3][a[r&255]]};s.cipher.aes.prototype={encrypt:function(e){return this._crypt(e,0)},decrypt:function(e){return this._crypt(e,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var e=this._tables[0],t=this._tables[1],n=e[4],r=t[4],i,o,a,c=[],l=[],h,f,u,d,p,m;for(i=0;i<256;i++)l[(c[i]=i<<1^(i>>7)*283)^i]=i;for(o=a=0;!n[o];o^=h||1,a=l[a]||1)for(d=a^a<<1^a<<2^a<<3^a<<4,d=d>>8^d&255^99,n[o]=d,r[d]=o,u=c[f=c[h=c[o]]],m=u*16843009^f*65537^h*257^o*16843008,p=c[d]*257^d*16843008,i=0;i<4;i++)e[i][o]=p=p<<24^p>>>8,t[i][d]=m=m<<24^m>>>8;for(i=0;i<5;i++)e[i]=e[i].slice(0),t[i]=t[i].slice(0)},_crypt:function(e,t){if(e.length!==4)throw new s.exception.invalid("invalid aes block size");var n=this._key[t],r=e[0]^n[0],i=e[t?3:1]^n[1],o=e[2]^n[2],a=e[t?1:3]^n[3],c,l,h,f=n.length/4-2,u,d=4,p=[0,0,0,0],m=this._tables[t],y=m[0],S=m[1],x=m[2],_=m[3],E=m[4];for(u=0;u<f;u++)c=y[r>>>24]^S[i>>16&255]^x[o>>8&255]^_[a&255]^n[d],l=y[i>>>24]^S[o>>16&255]^x[a>>8&255]^_[r&255]^n[d+1],h=y[o>>>24]^S[a>>16&255]^x[r>>8&255]^_[i&255]^n[d+2],a=y[a>>>24]^S[r>>16&255]^x[i>>8&255]^_[o&255]^n[d+3],d+=4,r=c,i=l,o=h;for(u=0;u<4;u++)p[t?3&-u:u]=E[r>>>24]<<24^E[i>>16&255]<<16^E[o>>8&255]<<8^E[a&255]^n[d++],c=r,r=i,i=o,o=a,a=c;return p}};s.bitArray={bitSlice:function(e,t,n){return e=s.bitArray._shiftRight(e.slice(t/32),32-(t&31)).slice(1),n===void 0?e:s.bitArray.clamp(e,n-t)},extract:function(e,t,n){var r,i=Math.floor(-t-n&31);return(t+n-1^t)&-32?r=e[t/32|0]<<32-i^e[t/32+1|0]>>>i:r=e[t/32|0]>>>i,r&(1<<n)-1},concat:function(e,t){if(e.length===0||t.length===0)return e.concat(t);var n=e[e.length-1],r=s.bitArray.getPartial(n);return r===32?e.concat(t):s.bitArray._shiftRight(t,r,n|0,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length,n;return t===0?0:(n=e[t-1],(t-1)*32+s.bitArray.getPartial(n))},clamp:function(e,t){if(e.length*32<t)return e;e=e.slice(0,Math.ceil(t/32));var n=e.length;return t=t&31,n>0&&t&&(e[n-1]=s.bitArray.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:function(e,t,n){return e===32?t:(n?t|0:t<<32-e)+e*1099511627776},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(s.bitArray.bitLength(e)!==s.bitArray.bitLength(t))return!1;var n=0,r;for(r=0;r<e.length;r++)n|=e[r]^t[r];return n===0},_shiftRight:function(e,t,n,r){var i,o=0,a;for(r===void 0&&(r=[]);t>=32;t-=32)r.push(n),n=0;if(t===0)return r.concat(e);for(i=0;i<e.length;i++)r.push(n|e[i]>>>t),n=e[i]<<32-t;return o=e.length?e[e.length-1]:0,a=s.bitArray.getPartial(o),r.push(s.bitArray.partial(t+a&31,t+a>32?n:r.pop(),1)),r},_xor4:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},byteswapM:function(e){var t,n,r=65280;for(t=0;t<e.length;++t)n=e[t],e[t]=n>>>24|n>>>8&r|(n&r)<<8|n<<24;return e}};s.codec.utf8String={fromBits:function(e){var t="",n=s.bitArray.bitLength(e),r,i;for(r=0;r<n/8;r++)r&3||(i=e[r/4]),t+=String.fromCharCode(i>>>8>>>8>>>8),i<<=8;return decodeURIComponent(escape(t))},toBits:function(e){e=unescape(encodeURIComponent(e));var t=[],n,r=0;for(n=0;n<e.length;n++)r=r<<8|e.charCodeAt(n),(n&3)===3&&(t.push(r),r=0);return n&3&&t.push(s.bitArray.partial(8*(n&3),r)),t}};s.codec.hex={fromBits:function(e){var t="",n;for(n=0;n<e.length;n++)t+=((e[n]|0)+0xf00000000000).toString(16).substr(4);return t.substr(0,s.bitArray.bitLength(e)/4)},toBits:function(e){var t,n=[],r;for(e=e.replace(/\s|0x/g,""),r=e.length,e=e+"00000000",t=0;t<e.length;t+=8)n.push(parseInt(e.substr(t,8),16)^0);return s.bitArray.clamp(n,r*4)}};s.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,n){var r="",i,o=0,a=s.codec.base64._chars,c=0,l=s.bitArray.bitLength(e);for(n&&(a=a.substr(0,62)+"-_"),i=0;r.length*6<l;)r+=a.charAt((c^e[i]>>>o)>>>26),o<6?(c=e[i]<<6-o,o+=26,i++):(c<<=6,o-=6);for(;r.length&3&&!t;)r+="=";return r},toBits:function(e,t){e=e.replace(/\s|=/g,"");var n=[],r,i=0,o=s.codec.base64._chars,a=0,c;for(t&&(o=o.substr(0,62)+"-_"),r=0;r<e.length;r++){if(c=o.indexOf(e.charAt(r)),c<0)throw new s.exception.invalid("this isn't base64!");i>26?(i-=26,n.push(a^c>>>i),a=c<<32-i):(i+=6,a^=c<<32-i)}return i&56&&n.push(s.bitArray.partial(i&56,a,1)),n}};s.codec.base64url={fromBits:function(e){return s.codec.base64.fromBits(e,1,1)},toBits:function(e){return s.codec.base64.toBits(e,1)}};s.codec.bytes={fromBits:function(e){var t=[],n=s.bitArray.bitLength(e),r,i;for(r=0;r<n/8;r++)r&3||(i=e[r/4]),t.push(i>>>24),i<<=8;return t},toBits:function(e){var t=[],n,r=0;for(n=0;n<e.length;n++)r=r<<8|e[n],(n&3)===3&&(t.push(r),r=0);return n&3&&t.push(s.bitArray.partial(8*(n&3),r)),t}};s.hash.sha256=function(e){this._key[0]||this._precompute(),e?(this._h=e._h.slice(0),this._buffer=e._buffer.slice(0),this._length=e._length):this.reset()};s.hash.sha256.hash=function(e){return new s.hash.sha256().update(e).finalize()};s.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(e){typeof e=="string"&&(e=s.codec.utf8String.toBits(e));var t,n=this._buffer=s.bitArray.concat(this._buffer,e),r=this._length,i=this._length=r+s.bitArray.bitLength(e);if(i>9007199254740991)throw new s.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var o=new Uint32Array(n),a=0;for(t=512+r-(512+r&511);t<=i;t+=512)this._block(o.subarray(16*a,16*(a+1))),a+=1;n.splice(0,16*a)}else for(t=512+r-(512+r&511);t<=i;t+=512)this._block(n.splice(0,16));return this},finalize:function(){var e,t=this._buffer,n=this._h;for(t=s.bitArray.concat(t,[s.bitArray.partial(1,1)]),e=t.length+2;e&15;e++)t.push(0);for(t.push(Math.floor(this._length/4294967296)),t.push(this._length|0);t.length;)this._block(t.splice(0,16));return this.reset(),n},_init:[],_key:[],_precompute:function(){var e=0,t=2,n,r;function i(o){return(o-Math.floor(o))*4294967296|0}for(;e<64;t++){for(r=!0,n=2;n*n<=t;n++)if(t%n===0){r=!1;break}r&&(e<8&&(this._init[e]=i(Math.pow(t,1/2))),this._key[e]=i(Math.pow(t,1/3)),e++)}},_block:function(e){var t,n,r,i,o=this._h,a=this._key,c=o[0],l=o[1],h=o[2],f=o[3],u=o[4],d=o[5],p=o[6],m=o[7];for(t=0;t<64;t++)t<16?n=e[t]:(r=e[t+1&15],i=e[t+14&15],n=e[t&15]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+e[t&15]+e[t+9&15]|0),n=n+m+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(p^u&(d^p))+a[t],m=p,p=d,d=u,u=f+n|0,f=h,h=l,l=c,c=n+(l&h^f&(l^h))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;o[0]=o[0]+c|0,o[1]=o[1]+l|0,o[2]=o[2]+h|0,o[3]=o[3]+f|0,o[4]=o[4]+u|0,o[5]=o[5]+d|0,o[6]=o[6]+p|0,o[7]=o[7]+m|0}};s.mode.ccm={name:"ccm",_progressListeners:[],listenProgress:function(e){s.mode.ccm._progressListeners.push(e)},unListenProgress:function(e){var t=s.mode.ccm._progressListeners.indexOf(e);t>-1&&s.mode.ccm._progressListeners.splice(t,1)},_callProgressListener:function(e){var t=s.mode.ccm._progressListeners.slice(),n;for(n=0;n<t.length;n+=1)t[n](e)},encrypt:function(e,t,n,r,i){var o,a=t.slice(0),c,l=s.bitArray,h=l.bitLength(n)/8,f=l.bitLength(a)/8;if(i=i||64,r=r||[],h<7)throw new s.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;o<4&&f>>>8*o;o++);return o<15-h&&(o=15-h),n=l.clamp(n,8*(15-o)),c=s.mode.ccm._computeTag(e,t,n,r,i,o),a=s.mode.ccm._ctrMode(e,a,n,c,i,o),l.concat(a.data,a.tag)},decrypt:function(e,t,n,r,i){i=i||64,r=r||[];var o,a=s.bitArray,c=a.bitLength(n)/8,l=a.bitLength(t),h=a.clamp(t,l-i),f=a.bitSlice(t,l-i),u;if(l=(l-i)/8,c<7)throw new s.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;o<4&&l>>>8*o;o++);if(o<15-c&&(o=15-c),n=a.clamp(n,8*(15-o)),h=s.mode.ccm._ctrMode(e,h,n,f,i,o),u=s.mode.ccm._computeTag(e,h.data,n,r,i,o),!a.equal(h.tag,u))throw new s.exception.corrupt("ccm: tag doesn't match");return h.data},_macAdditionalData:function(e,t,n,r,i,o){var a,c,l,h=[],f=s.bitArray,u=f._xor4;if(a=[f.partial(8,(t.length?64:0)|r-2<<2|o-1)],a=f.concat(a,n),a[3]|=i,a=e.encrypt(a),t.length)for(c=f.bitLength(t)/8,c<=65279?h=[f.partial(16,c)]:c<=4294967295&&(h=f.concat([f.partial(16,65534)],[c])),h=f.concat(h,t),l=0;l<h.length;l+=4)a=e.encrypt(u(a,h.slice(l,l+4).concat([0,0,0])));return a},_computeTag:function(e,t,n,r,i,o){var a,c,l=s.bitArray,h=l._xor4;if(i/=8,i%2||i<4||i>16)throw new s.exception.invalid("ccm: invalid tag length");if(r.length>4294967295||t.length>4294967295)throw new s.exception.bug("ccm: can't deal with 4GiB or more data");for(a=s.mode.ccm._macAdditionalData(e,r,n,i,l.bitLength(t)/8,o),c=0;c<t.length;c+=4)a=e.encrypt(h(a,t.slice(c,c+4).concat([0,0,0])));return l.clamp(a,i*8)},_ctrMode:function(e,t,n,r,i,o){var a,c,l=s.bitArray,h=l._xor4,f,u=t.length,d=l.bitLength(t),p=u/50,m=p;if(f=l.concat([l.partial(8,o-1)],n).concat([0,0,0]).slice(0,4),r=l.bitSlice(h(r,e.encrypt(f)),0,i),!u)return{tag:r,data:[]};for(c=0;c<u;c+=4)c>p&&(s.mode.ccm._callProgressListener(c/u),p+=m),f[3]++,a=e.encrypt(f),t[c]^=a[0],t[c+1]^=a[1],t[c+2]^=a[2],t[c+3]^=a[3];return{tag:r,data:l.clamp(t,d)}}};s.misc.hmac=function(e,t){this._hash=t=t||s.hash.sha256;var n=[[],[]],r,i=t.prototype.blockSize/32;for(this._baseHash=[new t,new t],e.length>i&&(e=t.hash(e)),r=0;r<i;r++)n[0][r]=e[r]^909522486,n[1][r]=e[r]^1549556828;this._baseHash[0].update(n[0]),this._baseHash[1].update(n[1]),this._resultHash=new t(this._baseHash[0])};s.misc.hmac.prototype.encrypt=s.misc.hmac.prototype.mac=function(e){if(this._updated)throw new s.exception.invalid("encrypt on already updated hmac called!");return this.update(e),this.digest(e)};s.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1};s.misc.hmac.prototype.update=function(e){this._updated=!0,this._resultHash.update(e)};s.misc.hmac.prototype.digest=function(){var e=this._resultHash.finalize(),t=new this._hash(this._baseHash[1]).update(e).finalize();return this.reset(),t};s.misc.pbkdf2=function(e,t,n,r,i){if(n=n||1e4,r<0||n<0)throw new s.exception.invalid("invalid params to pbkdf2");typeof e=="string"&&(e=s.codec.utf8String.toBits(e)),typeof t=="string"&&(t=s.codec.utf8String.toBits(t)),i=i||s.misc.hmac;var o=new i(e),a,c,l,h,f,u=[],d=s.bitArray;for(f=1;32*u.length<(r||1);f++){for(a=c=o.encrypt(d.concat(t,[f])),l=1;l<n;l++)for(c=o.encrypt(c),h=0;h<c.length;h++)a[h]^=c[h];u=u.concat(a)}return r&&(u=d.clamp(u,r)),u};s.prng=function(e){this._pools=[new s.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=e,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80};s.prng.prototype={randomWords:function(e,t){var n=[],r,i=this.isReady(t),o;if(i===this._NOT_READY)throw new s.exception.notReady("generator isn't seeded");for(i&this._REQUIRES_RESEED&&this._reseedFromPools(!(i&this._READY)),r=0;r<e;r+=4)(r+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),o=this._gen4words(),n.push(o[0],o[1],o[2],o[3]);return this._gate(),n.slice(0,e)},setDefaultParanoia:function(e,t){if(e===0&&t!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new s.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this._defaultParanoia=e},addEntropy:function(e,t,n){n=n||"user";var r,i,o,a=new Date().valueOf(),c=this._robins[n],l=this.isReady(),h=0,f;switch(r=this._collectorIds[n],r===void 0&&(r=this._collectorIds[n]=this._collectorIdNext++),c===void 0&&(c=this._robins[n]=0),this._robins[n]=(this._robins[n]+1)%this._pools.length,typeof e){case"number":t===void 0&&(t=1),this._pools[c].update([r,this._eventId++,1,t,a,1,e|0]);break;case"object":if(f=Object.prototype.toString.call(e),f==="[object Uint32Array]"){for(o=[],i=0;i<e.length;i++)o.push(e[i]);e=o}else for(f!=="[object Array]"&&(h=1),i=0;i<e.length&&!h;i++)typeof e[i]!="number"&&(h=1);if(!h){if(t===void 0)for(t=0,i=0;i<e.length;i++)for(o=e[i];o>0;)t++,o=o>>>1;this._pools[c].update([r,this._eventId++,2,t,a,e.length].concat(e))}break;case"string":t===void 0&&(t=e.length),this._pools[c].update([r,this._eventId++,3,t,a,e.length]),this._pools[c].update(e);break;default:h=1}if(h)throw new s.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[c]+=t,this._poolStrength+=t,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(e){var t=this._PARANOIA_LEVELS[e!==void 0?e:this._defaultParanoia];return this._strength&&this._strength>=t?this._poolEntropy[0]>this._BITS_PER_RESEED&&new Date().valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=t?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(e){var t=this._PARANOIA_LEVELS[e||this._defaultParanoia];return this._strength>=t||this._poolStrength>t?1:this._poolStrength/t},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector);else throw new s.exception.bug("can't attach event");this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(e,t){this._callbacks[e][this._callbackI++]=t},removeEventListener:function(e,t){var n,r,i=this._callbacks[e],o=[];for(r in i)i.hasOwnProperty(r)&&i[r]===t&&o.push(r);for(n=0;n<o.length;n++)r=o[n],delete i[r]},_bind:function(e){var t=this;return function(){e.apply(t,arguments)}},_gen4words:function(){for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new s.cipher.aes(this._key)},_reseed:function(e){this._key=s.hash.sha256.hash(this._key.concat(e)),this._cipher=new s.cipher.aes(this._key);for(var t=0;t<4&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);},_reseedFromPools:function(e){var t=[],n=0,r;for(this._nextReseed=t[0]=new Date().valueOf()+this._MILLISECONDS_PER_RESEED,r=0;r<16;r++)t.push(Math.random()*4294967296|0);for(r=0;r<this._pools.length&&(t=t.concat(this._pools[r].finalize()),n+=this._poolEntropy[r],this._poolEntropy[r]=0,!(!e&&this._reseedCount&1<<r));r++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new s.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=n,n>this._strength&&(this._strength=n),this._reseedCount++,this._reseed(t)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(e){var t,n;try{t=e.x||e.clientX||e.offsetX||0,n=e.y||e.clientY||e.offsetY||0}catch{t=0,n=0}t!=0&&n!=0&&this.addEntropy([t,n],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(e){var t=e.touches[0]||e.changedTouches[0],n=t.pageX||t.clientX,r=t.pageY||t.clientY;this.addEntropy([n,r],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(e){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?this.addEntropy(window.performance.now(),e,"loadtime"):this.addEntropy(new Date().valueOf(),e,"loadtime")},_accelerometerCollector:function(e){var t=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z;if(window.orientation){var n=window.orientation;typeof n=="number"&&this.addEntropy(n,1,"accelerometer")}t&&this.addEntropy(t,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(e,t){var n,r=s.random._callbacks[e],i=[];for(n in r)r.hasOwnProperty(n)&&i.push(r[n]);for(n=0;n<i.length;n++)i[n](t)}};s.random=new s.prng(6);(function(){function e(){try{return Le("crypto")}catch{return null}}try{var t,n,r;if(typeof module<"u"&&module.exports&&(n=e())&&n.randomBytes)t=n.randomBytes(1024/8),t=new Uint32Array(new Uint8Array(t).buffer),s.random.addEntropy(t,1024,"crypto.randomBytes");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(r=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(r);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(r);else return;s.random.addEntropy(r,1024,"crypto.getRandomValues")}}catch(i){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(i))}})();s.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(e,t,n,r){n=n||{},r=r||{};var i=s.json,o=i._add({iv:s.random.randomWords(4,0)},i.defaults),a,c,l;if(i._add(o,n),l=o.adata,typeof o.salt=="string"&&(o.salt=s.codec.base64.toBits(o.salt)),typeof o.iv=="string"&&(o.iv=s.codec.base64.toBits(o.iv)),!s.mode[o.mode]||!s.cipher[o.cipher]||typeof e=="string"&&o.iter<=100||o.ts!==64&&o.ts!==96&&o.ts!==128||o.ks!==128&&o.ks!==192&&o.ks!==256||o.iv.length<2||o.iv.length>4)throw new s.exception.invalid("json encrypt: invalid parameters");return typeof e=="string"?(a=s.misc.cachedPbkdf2(e,o),e=a.key.slice(0,o.ks/32),o.salt=a.salt):s.ecc&&e instanceof s.ecc.elGamal.publicKey&&(a=e.kem(),o.kemtag=a.tag,e=a.key.slice(0,o.ks/32)),typeof t=="string"&&(t=s.codec.utf8String.toBits(t)),typeof l=="string"&&(o.adata=l=s.codec.utf8String.toBits(l)),c=new s.cipher[o.cipher](e),i._add(r,o),r.key=e,o.mode==="ccm"&&s.arrayBuffer&&s.arrayBuffer.ccm&&t instanceof ArrayBuffer?o.ct=s.arrayBuffer.ccm.encrypt(c,t,o.iv,l,o.ts):o.ct=s.mode[o.mode].encrypt(c,t,o.iv,l,o.ts),o},encrypt:function(e,t,n,r){var i=s.json,o=i._encrypt.apply(i,arguments);return i.encode(o)},_decrypt:function(e,t,n,r){n=n||{},r=r||{};var i=s.json,o=i._add(i._add(i._add({},i.defaults),t),n,!0),a,c,l,h=o.adata;if(typeof o.salt=="string"&&(o.salt=s.codec.base64.toBits(o.salt)),typeof o.iv=="string"&&(o.iv=s.codec.base64.toBits(o.iv)),!s.mode[o.mode]||!s.cipher[o.cipher]||typeof e=="string"&&o.iter<=100||o.ts!==64&&o.ts!==96&&o.ts!==128||o.ks!==128&&o.ks!==192&&o.ks!==256||!o.iv||o.iv.length<2||o.iv.length>4)throw new s.exception.invalid("json decrypt: invalid parameters");return typeof e=="string"?(c=s.misc.cachedPbkdf2(e,o),e=c.key.slice(0,o.ks/32),o.salt=c.salt):s.ecc&&e instanceof s.ecc.elGamal.secretKey&&(e=e.unkem(s.codec.base64.toBits(o.kemtag)).slice(0,o.ks/32)),typeof h=="string"&&(h=s.codec.utf8String.toBits(h)),l=new s.cipher[o.cipher](e),o.mode==="ccm"&&s.arrayBuffer&&s.arrayBuffer.ccm&&o.ct instanceof ArrayBuffer?a=s.arrayBuffer.ccm.decrypt(l,o.ct,o.iv,o.tag,h,o.ts):a=s.mode[o.mode].decrypt(l,o.ct,o.iv,h,o.ts),i._add(r,o),r.key=e,n.raw===1?a:s.codec.utf8String.fromBits(a)},decrypt:function(e,t,n,r){var i=s.json;return i._decrypt(e,i.decode(t),n,r)},encode:function(e){var t,n="{",r="";for(t in e)if(e.hasOwnProperty(t)){if(!t.match(/^[a-z0-9]+$/i))throw new s.exception.invalid("json encode: invalid property name");switch(n+=r+'"'+t+'":',r=",",typeof e[t]){case"number":case"boolean":n+=e[t];break;case"string":n+='"'+escape(e[t])+'"';break;case"object":n+='"'+s.codec.base64.fromBits(e[t],0)+'"';break;default:throw new s.exception.bug("json encode: unsupported type")}}return n+"}"},decode:function(e){if(e=e.replace(/\s/g,""),!e.match(/^\{.*\}$/))throw new s.exception.invalid("json decode: this isn't json!");var t=e.replace(/^\{|\}$/g,"").split(/,/),n={},r,i;for(r=0;r<t.length;r++){if(!(i=t[r].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new s.exception.invalid("json decode: this isn't json!");i[3]!=null?n[i[2]]=parseInt(i[3],10):i[4]!=null?n[i[2]]=i[2].match(/^(ct|adata|salt|iv)$/)?s.codec.base64.toBits(i[4]):unescape(i[4]):i[5]!=null&&(n[i[2]]=i[5]==="true")}return n},_add:function(e,t,n){if(e===void 0&&(e={}),t===void 0)return e;var r;for(r in t)if(t.hasOwnProperty(r)){if(n&&e[r]!==void 0&&e[r]!==t[r])throw new s.exception.invalid("required parameter overridden");e[r]=t[r]}return e},_subtract:function(e,t){var n={},r;for(r in e)e.hasOwnProperty(r)&&e[r]!==t[r]&&(n[r]=e[r]);return n},_filter:function(e,t){var n={},r;for(r=0;r<t.length;r++)e[t[r]]!==void 0&&(n[t[r]]=e[t[r]]);return n}};s.encrypt=s.json.encrypt;s.decrypt=s.json.decrypt;s.misc._pbkdf2Cache={};s.misc.cachedPbkdf2=function(e,t){var n=s.misc._pbkdf2Cache,r,i,o,a,c;return t=t||{},c=t.iter||1e3,i=n[e]=n[e]||{},r=i[c]=i[c]||{firstSalt:t.salt&&t.salt.length?t.salt.slice(0):s.random.randomWords(2,0)},a=t.salt===void 0?r.firstSalt:t.salt,r[a]=r[a]||s.misc.pbkdf2(e,a,t.iter),{key:r[a].slice(0),salt:a.slice(0)}};s.bn=function(e){this.initWith(e)};s.bn.prototype={radix:24,maxMul:8,_class:s.bn,copy:function(){return new this._class(this)},initWith:function(e){var t=0,n;switch(typeof e){case"object":this.limbs=e.limbs.slice(0);break;case"number":this.limbs=[e],this.normalize();break;case"string":for(e=e.replace(/^0x/,""),this.limbs=[],n=this.radix/4,t=0;t<e.length;t+=n)this.limbs.push(parseInt(e.substring(Math.max(e.length-t-n,0),e.length-t),16));break;default:this.limbs=[0]}return this},equals:function(e){typeof e=="number"&&(e=new this._class(e));var t=0,n;for(this.fullReduce(),e.fullReduce(),n=0;n<this.limbs.length||n<e.limbs.length;n++)t|=this.getLimb(n)^e.getLimb(n);return t===0},getLimb:function(e){return e>=this.limbs.length?0:this.limbs[e]},greaterEquals:function(e){typeof e=="number"&&(e=new this._class(e));var t=0,n=0,r,i,o;for(r=Math.max(this.limbs.length,e.limbs.length)-1;r>=0;r--)i=this.getLimb(r),o=e.getLimb(r),n|=o-i&~t,t|=i-o&~n;return(n|~t)>>>31},toString:function(){this.fullReduce();var e="",t,n,r=this.limbs;for(t=0;t<this.limbs.length;t++){for(n=r[t].toString(16);t<this.limbs.length-1&&n.length<6;)n="0"+n;e=n+e}return"0x"+e},addM:function(e){typeof e!="object"&&(e=new this._class(e));var t,n=this.limbs,r=e.limbs;for(t=n.length;t<r.length;t++)n[t]=0;for(t=0;t<r.length;t++)n[t]+=r[t];return this},doubleM:function(){var e,t=0,n,r=this.radix,i=this.radixMask,o=this.limbs;for(e=0;e<o.length;e++)n=o[e],n=n+n+t,o[e]=n&i,t=n>>r;return t&&o.push(t),this},halveM:function(){var e,t=0,n,r=this.radix,i=this.limbs;for(e=i.length-1;e>=0;e--)n=i[e],i[e]=n+t>>1,t=(n&1)<<r;return i[i.length-1]||i.pop(),this},subM:function(e){typeof e!="object"&&(e=new this._class(e));var t,n=this.limbs,r=e.limbs;for(t=n.length;t<r.length;t++)n[t]=0;for(t=0;t<r.length;t++)n[t]-=r[t];return this},mod:function(e){var t=!this.greaterEquals(new s.bn(0));e=new s.bn(e).normalize();var n=new s.bn(this).normalize(),r=0;for(t&&(n=new s.bn(0).subM(n).normalize());n.greaterEquals(e);r++)e.doubleM();for(t&&(n=e.sub(n).normalize());r>0;r--)e.halveM(),n.greaterEquals(e)&&n.subM(e).normalize();return n.trim()},inverseMod:function(e){var t=new s.bn(1),n=new s.bn(0),r=new s.bn(this),i=new s.bn(e),o,a,c=1;if(!(e.limbs[0]&1))throw new s.exception.invalid("inverseMod: p must be odd");do for(r.limbs[0]&1&&(r.greaterEquals(i)||(o=r,r=i,i=o,o=t,t=n,n=o),r.subM(i),r.normalize(),t.greaterEquals(n)||t.addM(e),t.subM(n)),r.halveM(),t.limbs[0]&1&&t.addM(e),t.normalize(),t.halveM(),a=c=0;a<r.limbs.length;a++)c|=r.limbs[a];while(c);if(!i.equals(1))throw new s.exception.invalid("inverseMod: p and x must be relatively prime");return n},add:function(e){return this.copy().addM(e)},sub:function(e){return this.copy().subM(e)},mul:function(e){typeof e=="number"?e=new this._class(e):e.normalize(),this.normalize();var t,n,r=this.limbs,i=e.limbs,o=r.length,a=i.length,c=new this._class,l=c.limbs,h,f=this.maxMul;for(t=0;t<this.limbs.length+e.limbs.length+1;t++)l[t]=0;for(t=0;t<o;t++){for(h=r[t],n=0;n<a;n++)l[t+n]+=h*i[n];--f||(f=this.maxMul,c.cnormalize())}return c.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(e){e=new s.bn(e).normalize().trim().limbs;var t,n,r=new this._class(1),i=this;for(t=0;t<e.length;t++)for(n=0;n<this.radix&&(e[t]&1<<n&&(r=r.mul(i)),!(t==e.length-1&&!(e[t]>>n+1)));n++)i=i.square();return r},mulmod:function(e,t){return this.mod(t).mul(e.mod(t)).mod(t)},powermod:function(e,t){if(e=new s.bn(e),t=new s.bn(t),(t.limbs[0]&1)==1){var n=this.montpowermod(e,t);if(n!=!1)return n}var r,i,o=e.normalize().trim().limbs,a=new this._class(1),c=this;for(r=0;r<o.length;r++)for(i=0;i<this.radix&&(o[r]&1<<i&&(a=a.mulmod(c,t)),!(r==o.length-1&&!(o[r]>>i+1)));i++)c=c.mulmod(c,t);return a},montpowermod:function(e,t){e=new s.bn(e).normalize().trim(),t=new s.bn(t);var n,r,i=this.radix,o=new this._class(1),a=this.copy(),c,l,h,f=e.bitLength();for(c=new s.bn({limbs:t.copy().normalize().trim().limbs.map(function(){return 0})}),l=this.radix;l>0;l--)if((t.limbs[t.limbs.length-1]>>l&1)==1){c.limbs[c.limbs.length-1]=1<<l;break}if(f==0)return this;f<18?h=1:f<48?h=3:f<144?h=4:f<768?h=5:h=6;for(var u=c.copy(),d=t.copy(),p=new s.bn(1),m=new s.bn(0),y=c.copy();y.greaterEquals(1);)y.halveM(),p.limbs[0]&1?(p.addM(d),p.halveM(),m.halveM(),m.addM(u)):(p.halveM(),m.halveM());p=p.normalize(),m=m.normalize(),u.doubleM();var S=u.mulmod(u,t);if(!u.mul(p).sub(t.mul(m)).equals(1))return!1;var x=function(R){return _(R,S)},_=function(R,j){var v,$,L,A,oe=(1<<l+1)-1;for($=R.mul(j),L=$.mul(m),L.limbs=L.limbs.slice(0,c.limbs.length),L.limbs.length==c.limbs.length&&(L.limbs[c.limbs.length-1]&=oe),L=L.mul(t),A=$.add(L).normalize().trim(),A.limbs=A.limbs.slice(c.limbs.length-1),v=0;v<A.limbs.length;v++)v>0&&(A.limbs[v-1]|=(A.limbs[v]&oe)<<i-l-1),A.limbs[v]=A.limbs[v]>>l+1;return A.greaterEquals(t)&&A.subM(t),A},E=function(R){return _(R,1)};a=x(a),o=x(o);var O,C={},Ee=(1<<h-1)-1;for(C[1]=a.copy(),C[2]=_(a,a),O=1;O<=Ee;O++)C[2*O+1]=_(C[2*O-1],C[2]);var Z=function(R,j){var v=j%R.radix;return(R.limbs[Math.floor(j/R.radix)]&1<<v)>>v};for(n=e.bitLength()-1;n>=0;)if(Z(e,n)==0)o=_(o,o),n=n-1;else{for(var K=n-h+1;Z(e,K)==0;)K++;var ie=0;for(r=K;r<=n;r++)ie+=Z(e,r)<<r-K,o=_(o,o);o=_(o,C[ie]),n=K-1}return E(o)},trim:function(){var e=this.limbs,t;do t=e.pop();while(e.length&&t===0);return e.push(t),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var e=0,t,n=this.placeVal,r=this.ipv,i,o,a=this.limbs,c=a.length,l=this.radixMask;for(t=0;t<c||e!==0&&e!==-1;t++)i=(a[t]||0)+e,o=a[t]=i&l,e=(i-o)*r;return e===-1&&(a[t-1]-=n),this.trim(),this},cnormalize:function(){var e=0,t,n=this.ipv,r,i,o=this.limbs,a=o.length,c=this.radixMask;for(t=0;t<a-1;t++)r=o[t]+e,i=o[t]=r&c,e=(r-i)*n;return o[t]+=e,this},toBits:function(e){this.fullReduce(),e=e||this.exponent||this.bitLength();var t=Math.floor((e-1)/24),n=s.bitArray,r=(e+7&-8)%this.radix||this.radix,i=[n.partial(r,this.getLimb(t))];for(t--;t>=0;t--)i=n.concat(i,[n.partial(Math.min(this.radix,e),this.getLimb(t))]),e-=this.radix;return i},bitLength:function(){this.fullReduce();for(var e=this.radix*(this.limbs.length-1),t=this.limbs[this.limbs.length-1];t;t>>>=1)e++;return e+7&-8}};s.bn.fromBits=function(e){var t=this,n=new t,r=[],i=s.bitArray,o=this.prototype,a=Math.min(this.bitLength||4294967296,i.bitLength(e)),c=a%o.radix||o.radix;for(r[0]=i.extract(e,0,c);c<a;c+=o.radix)r.unshift(i.extract(e,c,o.radix));return n.limbs=r,n};s.bn.prototype.ipv=1/(s.bn.prototype.placeVal=Math.pow(2,s.bn.prototype.radix));s.bn.prototype.radixMask=(1<<s.bn.prototype.radix)-1;s.bn.pseudoMersennePrime=function(e,t){function n(c){this.initWith(c)}var r=n.prototype=new s.bn,i,o,a;for(a=r.modOffset=Math.ceil(o=e/r.radix),r.exponent=e,r.offset=[],r.factor=[],r.minOffset=a,r.fullMask=0,r.fullOffset=[],r.fullFactor=[],r.modulus=n.modulus=new s.bn(Math.pow(2,e)),r.fullMask=0|-Math.pow(2,e%r.radix),i=0;i<t.length;i++)r.offset[i]=Math.floor(t[i][0]/r.radix-o),r.fullOffset[i]=Math.floor(t[i][0]/r.radix)-a+1,r.factor[i]=t[i][1]*Math.pow(1/2,e-t[i][0]+r.offset[i]*r.radix),r.fullFactor[i]=t[i][1]*Math.pow(1/2,e-t[i][0]+r.fullOffset[i]*r.radix),r.modulus.addM(new s.bn(Math.pow(2,t[i][0])*t[i][1])),r.minOffset=Math.min(r.minOffset,-r.offset[i]);return r._class=n,r.modulus.cnormalize(),r.reduce=function(){var c,l,h,f=this.modOffset,u=this.limbs,d=this.offset,p=this.offset.length,m=this.factor,y;for(c=this.minOffset;u.length>f;){for(h=u.pop(),y=u.length,l=0;l<p;l++)u[y+d[l]]-=m[l]*h;c--,c||(u.push(0),this.cnormalize(),c=this.minOffset)}return this.cnormalize(),this},r._strongReduce=r.fullMask===-1?r.reduce:function(){var c=this.limbs,l=c.length-1,h,f;if(this.reduce(),l===this.modOffset-1){for(f=c[l]&this.fullMask,c[l]-=f,h=0;h<this.fullOffset.length;h++)c[l+this.fullOffset[h]]-=this.fullFactor[h]*f;this.normalize()}},r.fullReduce=function(){var c,l;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),l=this.limbs.length;l<this.modOffset;l++)this.limbs[l]=0;for(c=this.greaterEquals(this.modulus),l=0;l<this.limbs.length;l++)this.limbs[l]-=this.modulus.limbs[l]*c;return this.cnormalize(),this},r.inverse=function(){return this.power(this.modulus.sub(2))},n.fromBits=s.bn.fromBits,n};var B=s.bn.pseudoMersennePrime;s.bn.prime={p127:B(127,[[0,-1]]),p25519:B(255,[[0,-19]]),p192k:B(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:B(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:B(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:B(192,[[0,-1],[64,-1]]),p224:B(224,[[0,1],[96,-1]]),p256:B(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:B(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:B(521,[[0,-1]])};s.bn.random=function(e,t){typeof e!="object"&&(e=new s.bn(e));for(var n,r,i=e.limbs.length,o=e.limbs[i-1]+1,a=new s.bn;;){do n=s.random.randomWords(i,t),n[i-1]<0&&(n[i-1]+=4294967296);while(Math.floor(n[i-1]/o)===Math.floor(4294967296/o));for(n[i-1]%=o,r=0;r<i-1;r++)n[r]&=e.radixMask;if(a.limbs=n,!a.greaterEquals(e))return a}};typeof ArrayBuffer>"u"&&function(e){"use strict";e.ArrayBuffer=function(){},e.DataView=function(){}}(void 0);s.codec.arrayBuffer={fromBits:function(e,t,n){var r,i,o,a,c;if(t=t??!0,n=n||8,e.length===0)return new ArrayBuffer(0);if(o=s.bitArray.bitLength(e)/8,s.bitArray.bitLength(e)%8!==0)throw new s.exception.invalid("Invalid bit size, must be divisble by 8 to fit in an arraybuffer correctly");for(t&&o%n!==0&&(o+=n-o%n),a=new DataView(new ArrayBuffer(e.length*4)),i=0;i<e.length;i++)a.setUint32(i*4,e[i]<<32);if(r=new DataView(new ArrayBuffer(o)),r.byteLength===a.byteLength)return a.buffer;for(c=a.byteLength<r.byteLength?a.byteLength:r.byteLength,i=0;i<c;i++)r.setUint8(i,a.getUint8(i));return r.buffer},toBits:function(e){var t,n=[],r,i,o;if(e.byteLength===0)return[];i=new DataView(e),r=i.byteLength-i.byteLength%4;for(var t=0;t<r;t+=4)n.push(i.getUint32(t));if(i.byteLength%4!=0){o=new DataView(new ArrayBuffer(4));for(var t=0,a=i.byteLength%4;t<a;t++)o.setUint8(t+4-a,i.getUint8(r+t));n.push(s.bitArray.partial(i.byteLength%4*8,o.getUint32(0)))}return n},hexDumpBuffer:function(e){for(var t=new DataView(e),n="",r=function(o,a){return o=o+"",o.length>=a?o:new Array(a-o.length+1).join("0")+o},i=0;i<t.byteLength;i+=2)i%16==0&&(n+=`
`+i.toString(16)+"	"),n+=r(t.getUint16(i).toString(16),4)+" ";typeof console===void 0&&(console=console||{log:function(){}}),console.log(n.toUpperCase())}};typeof module<"u"&&module.exports&&(module.exports=s);typeof define=="function"&&define([],function(){return s});var b=s;function F(e,t){throw new Error(`unexpected ${e} identifier: ${t}`)}function ke(e){switch(e){case"SHA-1":return{name:e,hLen:20};case"SHA-256":return{name:e,hLen:32};case"SHA-384":return{name:e,hLen:48};case"SHA-512":return{name:e,hLen:64};default:F("Hash",e)}}function P(e){return b.bn.fromBits(b.codec.bytes.toBits(e))}function z(e,t){if(Math.ceil(e.bitLength()/8)>t)throw new Error(`number does not fit in ${t} bytes`);let n=new Uint8Array(t),r=new Uint8Array(b.codec.bytes.fromBits(e.toBits(void 0),!1));return n.set(r,t-r.length),n}function k(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r].length;let n=new Uint8Array(new ArrayBuffer(t));for(let r=0,i=0;r<e.length;r++)n.set(e[r],i),i+=e[r].length;return n}function Pe(e,t){if(e.length!==t.length||e.length===0)throw new Error("arrays of different length: "+e.length+" - "+t.length);let n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e[i]^t[i];return r}function Me(e){e[3]++,e[3]==0&&(e[2]++,e[2]==0&&(e[1]++,e[1]==0&&e[0]++))}async function Ce(e,t,n){let r=Math.ceil(n/e.hLen);if(r>Math.pow(2,32))throw new Error("mask too long");let i=new Uint8Array,o=new Uint8Array(4);for(let a=0;a<r;a++){let c=new Uint8Array(await crypto.subtle.digest(e.name,k([t,o])));i=k([i,c]),Me(o)}return i.subarray(0,n)}async function W(e,t,n,r=Ce){let{hash:i,sLen:o}=n,a=ke(i),{hLen:c}=a,l=Math.ceil(t/8),h=new Uint8Array(await crypto.subtle.digest(i,e));if(l<c+o+2)throw new Error("encoding error");let f=crypto.getRandomValues(new Uint8Array(o)),u=k([new Uint8Array(8),h,f]),d=new Uint8Array(await crypto.subtle.digest(i,u)),p=new Uint8Array(l-o-c-2),m=k([p,Uint8Array.of(1),f]),y=await r(a,d,l-c-1),S=Pe(m,y);return S[0]&=255>>8*l-t,k([S,d,Uint8Array.of(188)])}function q(e,t){if(!t.greaterEquals(new b.bn(0))||t.greaterEquals(e.n)==1)throw new Error("signature representative out of range");return t.powermod(e.e,e.n)}function Y(e,t){if(!t.greaterEquals(new b.bn(0))||t.greaterEquals(e.n)==1)throw new Error("signature representative out of range");return t.powermod(e.d,e.n)}function X(e,t){try{e.inverseMod(t)}catch{return!1}return!0}function G(e,t){for(let r=0;r<128;r++){let i=P(crypto.getRandomValues(new Uint8Array(t)));if(!(i.greaterEquals(e)||i.equals(0)))return i}throw new Error("reached maximum tries for random integer generation")}var se="RSA-RAW";async function J(e,t){e.algorithm.name!==se&&(e=await crypto.subtle.importKey("pkcs8",await crypto.subtle.exportKey("pkcs8",e),{...e.algorithm,name:se},e.extractable,e.usages));let n=await crypto.subtle.sign({name:e.algorithm.name},e,t);return P(new Uint8Array(n))}var w;(function(e){e[e.Deterministic=0]="Deterministic",e[e.Randomized=32]="Randomized"})(w||(w={}));var M=class e{params;static NAME="RSA-PSS";constructor(t){switch(this.params=t,t.prepareType){case w.Deterministic:case w.Randomized:return;default:F("PrepareType",t.prepareType)}}toString(){let t=this.params.hash.replace("-",""),n="PSS"+(this.params.saltLength===0?"ZERO":""),r=w[this.params.prepareType];return`RSABSSA-${t}-${n}-${r}`}prepare(t){let n=this.params.prepareType,r=crypto.getRandomValues(new Uint8Array(n));return k([r,t])}async extractKeyParams(t,n){if(t.type!==n||t.algorithm.name!==e.NAME)throw new Error(`key is not ${e.NAME}`);if(!t.extractable)throw new Error("key is not extractable");let{modulusLength:r,hash:i}=t.algorithm,o=Math.ceil(r/8),a=i.name;if(a.toLowerCase()!==this.params.hash.toLowerCase())throw new Error(`hash is not ${this.params.hash}`);return{jwkKey:await crypto.subtle.exportKey("jwk",t),modulusLengthBits:r,modulusLengthBytes:o,hash:a}}async blind(t,n){let{jwkKey:r,modulusLengthBits:i,modulusLengthBytes:o,hash:a}=await this.extractKeyParams(t,"public");if(!r.n||!r.e)throw new Error("key has invalid parameters");let c=b.bn.fromBits(b.codec.base64url.toBits(r.n)),h={e:b.bn.fromBits(b.codec.base64url.toBits(r.e)),n:c},f={sLen:this.params.saltLength,hash:a},u=await W(n,i-1,f),d=P(u);if(X(d,c)===!1)throw new Error("invalid input");let m=G(c,o),y;try{y=z(m.inverseMod(c),o)}catch(E){throw new Error(`blinding error: ${E.toString()}`)}let S=q(h,m),x=d.mulmod(S,c);return{blindedMsg:z(x,o),inv:y}}async blindSign(t,n){let{jwkKey:r,modulusLengthBytes:i}=await this.extractKeyParams(t,"private");if(!r.n||!r.d)throw new Error("key has invalid parameters");let o=b.bn.fromBits(b.codec.base64url.toBits(r.n)),a=b.bn.fromBits(b.codec.base64url.toBits(r.d)),c=b.bn.fromBits(b.codec.base64url.toBits(r.e)),l={n:o,d:a},h={n:o,e:c},f=P(n),u;this.params.supportsRSARAW?u=await J(t,n):u=Y(l,f);let d=q(h,u);if(f.equals(d)===!1)throw new Error("signing failure");return z(u,i)}async finalize(t,n,r,i){let{jwkKey:o,modulusLengthBytes:a}=await this.extractKeyParams(t,"public");if(!o.n)throw new Error("key has invalid parameters");let c=b.bn.fromBits(b.codec.base64url.toBits(o.n));if(i.length!=a)throw new Error("unexpected input size");let l=P(i);if(r.length!=a)throw new Error("unexpected input size");let f=P(r).mulmod(l,c),u=z(f,a),d={name:e.NAME,saltLength:this.params.saltLength};if(!await crypto.subtle.verify(d,t,u,n))throw new Error("invalid signature");return u}static generateKey(t){return crypto.subtle.generateKey({...t,name:e.NAME},!0,["sign","verify"])}generateKey(t){return e.generateKey({...t,hash:this.params.hash})}verify(t,n,r){return crypto.subtle.verify({name:e.NAME,saltLength:this.params.saltLength},t,n,r)}};var ae;(function(e){e[e.Deterministic=0]="Deterministic",e[e.Randomized=32]="Randomized"})(ae||(ae={}));var H={RSABSSA_SHA384_PSS_Randomized:{name:"RSABSSA-SHA384-PSS-Randomized",hash:"SHA-384",saltLength:48,prepareType:w.Randomized},RSABSSA_SHA384_PSS_Deterministic:{name:"RSABSSA-SHA384-PSS-Deterministic",hash:"SHA-384",saltLength:48,prepareType:w.Deterministic},RSABSSA_SHA384_PSSZERO_Randomized:{name:"RSABSSA-SHA384-PSSZERO-Randomized",hash:"SHA-384",saltLength:0,prepareType:w.Randomized},RSABSSA_SHA384_PSSZERO_Deterministic:{name:"RSABSSA-SHA384-PSSZERO-Deterministic",hash:"SHA-384",saltLength:0,prepareType:w.Deterministic},RSAPBSSA_SHA384_PSS_Randomized:{name:"RSAPBSSA-SHA384-PSS-Randomized",hash:"SHA-384",saltLength:48,prepareType:w.Randomized},RSAPBSSA_SHA384_PSS_Deterministic:{name:"RSAPBSSA-SHA384-PSS-Deterministic",hash:"SHA-384",saltLength:48,prepareType:w.Deterministic},RSAPBSSA_SHA384_PSSZERO_Randomized:{name:"RSAPBSSA-SHA384-PSSZERO-Randomized",hash:"SHA-384",saltLength:0,prepareType:w.Randomized},RSAPBSSA_SHA384_PSSZERO_Deterministic:{name:"RSAPBSSA-SHA384-PSSZERO-Deterministic",hash:"SHA-384",saltLength:0,prepareType:w.Deterministic}},T={SHA384:{generateKey:e=>M.generateKey({...e,hash:"SHA-384"}),PSS:{Randomized:(e={supportsRSARAW:!1})=>new M({...H.RSABSSA_SHA384_PSS_Randomized,...e}),Deterministic:(e={supportsRSARAW:!1})=>new M({...H.RSABSSA_SHA384_PSS_Deterministic,...e})},PSSZero:{Randomized:(e={supportsRSARAW:!1})=>new M({...H.RSABSSA_SHA384_PSSZERO_Randomized,...e}),Deterministic:(e={supportsRSARAW:!1})=>new M({...H.RSABSSA_SHA384_PSSZERO_Deterministic,...e})}}};var de="3.7.7",ze=de,U=typeof Buffer=="function",ce=typeof TextDecoder=="function"?new TextDecoder:void 0,le=typeof TextEncoder=="function"?new TextEncoder:void 0,Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",I=Array.prototype.slice.call(Te),N=(e=>{let t={};return e.forEach((n,r)=>t[n]=r),t})(I),De=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,g=String.fromCharCode.bind(String),he=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),me=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),pe=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),be=e=>{let t,n,r,i,o="",a=e.length%3;for(let c=0;c<e.length;){if((n=e.charCodeAt(c++))>255||(r=e.charCodeAt(c++))>255||(i=e.charCodeAt(c++))>255)throw new TypeError("invalid character found");t=n<<16|r<<8|i,o+=I[t>>18&63]+I[t>>12&63]+I[t>>6&63]+I[t&63]}return a?o.slice(0,a-3)+"===".substring(a):o},te=typeof btoa=="function"?e=>btoa(e):U?e=>Buffer.from(e,"binary").toString("base64"):be,Q=U?e=>Buffer.from(e).toString("base64"):e=>{let n=[];for(let r=0,i=e.length;r<i;r+=4096)n.push(g.apply(null,e.subarray(r,r+4096)));return te(n.join(""))},V=(e,t=!1)=>t?me(Q(e)):Q(e),Ue=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?g(192|t>>>6)+g(128|t&63):g(224|t>>>12&15)+g(128|t>>>6&63)+g(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return g(240|t>>>18&7)+g(128|t>>>12&63)+g(128|t>>>6&63)+g(128|t&63)}},Oe=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ge=e=>e.replace(Oe,Ue),ue=U?e=>Buffer.from(e,"utf8").toString("base64"):le?e=>Q(le.encode(e)):e=>te(ge(e)),D=(e,t=!1)=>t?me(ue(e)):ue(e),fe=e=>D(e,!0),Ke=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Ie=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return g((n>>>10)+55296)+g((n&1023)+56320);case 3:return g((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return g((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},ye=e=>e.replace(Ke,Ie),we=e=>{if(e=e.replace(/\s+/g,""),!De.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,n="",r,i;for(let o=0;o<e.length;)t=N[e.charAt(o++)]<<18|N[e.charAt(o++)]<<12|(r=N[e.charAt(o++)])<<6|(i=N[e.charAt(o++)]),n+=r===64?g(t>>16&255):i===64?g(t>>16&255,t>>8&255):g(t>>16&255,t>>8&255,t&255);return n},re=typeof atob=="function"?e=>atob(pe(e)):U?e=>Buffer.from(e,"base64").toString("binary"):we,_e=U?e=>he(Buffer.from(e,"base64")):e=>he(re(e).split("").map(t=>t.charCodeAt(0))),Se=e=>_e(ve(e)),je=U?e=>Buffer.from(e,"base64").toString("utf8"):ce?e=>ce.decode(_e(e)):e=>ye(re(e)),ve=e=>pe(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),ee=e=>je(ve(e)),Fe=e=>{if(typeof e!="string")return!1;let t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},Ae=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),xe=function(){let e=(t,n)=>Object.defineProperty(String.prototype,t,Ae(n));e("fromBase64",function(){return ee(this)}),e("toBase64",function(t){return D(this,t)}),e("toBase64URI",function(){return D(this,!0)}),e("toBase64URL",function(){return D(this,!0)}),e("toUint8Array",function(){return Se(this)})},Be=function(){let e=(t,n)=>Object.defineProperty(Uint8Array.prototype,t,Ae(n));e("toBase64",function(t){return V(this,t)}),e("toBase64URI",function(){return V(this,!0)}),e("toBase64URL",function(){return V(this,!0)})},qe=()=>{xe(),Be()},ne={version:de,VERSION:ze,atob:re,atobPolyfill:we,btoa:te,btoaPolyfill:be,fromBase64:ee,toBase64:D,encode:D,encodeURI:fe,encodeURL:fe,utob:ge,btou:ye,decode:ee,isValid:Fe,fromUint8Array:V,toUint8Array:Se,extendString:xe,extendUint8Array:Be,extendBuiltins:qe};var yt=[T.SHA384.PSS.Randomized,T.SHA384.PSSZero.Randomized,T.SHA384.PSS.Deterministic,T.SHA384.PSSZero.Deterministic],Re=T.SHA384.PSS.Randomized();function He(e){for(var t=e.split(`
`),n="",r=0;r<t.length;r++)t[r].trim().length>0&&t[r].indexOf("-BEGIN RSA PRIVATE KEY-")<0&&t[r].indexOf("-BEGIN RSA PUBLIC KEY-")<0&&t[r].indexOf("-END RSA PRIVATE KEY-")<0&&t[r].indexOf("-END RSA PUBLIC KEY-")<0&&(n+=t[r].trim());return ne.toUint8Array(n)}function Ne(e){return new Promise(function(t){crypto.subtle.importKey("spki",He(e),{name:"RSA-PSS",hash:{name:"SHA-384"}},!0,["verify"]).then(function(r){t(r)})})}async function Ve(e){let n=await(await fetch(e)).text();return await JSON.parse(n)}async function Ze(){return await Ve("/api/json/publickey")}async function $e(e,t){let n=await fetch(e,{method:"POST",body:JSON.stringify(t)})}async function We(){let e=await Ze(),t=await Ne(e.serverpublickey);console.log(t);let r=new TextEncoder().encode("Alice and Bob"),i=Re.prepare(r),{blindedMsg:o,inv:a}=await Re.blind(t,i);console.log(o),await $e("/api/json/reqBlindSignature",{blindedMsg:ne.fromUint8Array(o)})}We();})();
